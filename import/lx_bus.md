# Новая архитектура шины Aleste

Финальная предлагаемая консолидированная распиновка (на 1 слот, 40 pin)
Цифровые Сигналы (3.3V LVCMOS)

| Группа     | Сигналы                               | Кол-во | Примечание                   |
|------------|---------------------------------------|--------|------------------------------|
| Питание    | +3.3V, +3.3V, GND, GND, GND           | 5      | 2 питания, 3 земли           |
| Интерфейсы | SPI_SCK, SPI_MOSI, SPI_MISO, SPI_CS_N | 4      | Основная цифровая магистраль |

|              | I2C_SDA, I2C_SCL           | 2   | Вторичная шина                                    |
|--------------|----------------------------|-----|---------------------------------------------------|
| Управление   | RESET_N (активный 0)       | 1   | Общий сброс                                       |
|              | PERIPH_RST_N               | 1/4 | Сброс периферийного устройства                    |
| Прерывания   | INT_N (общий, активный 0)  | 1   | Запрос на прерывание                              |
|              | NMI_N (активный 0)         | 1   | Немаскируемое прерывание (для критических ошибок) |
| Детекция     | DETECT_N                   | 1   | 0 - плата вставлена и/или не готова               |
|              |                            |     | 1 - плата готова / слот пуст                      |
| Тактирование | CLK_12M288                 | 1   | Тактовая частота 12.288 МГц (идеальна для аудио)  |
| GPIO         | GPIO0, GPIO1, GPIO2, GPIO3 | 4   | Программируемые линии общего назначения           |

Итого: 20

Аналоговые Сигналы (независимая земля!)

| Группа       | Сигналы                  | Кол-во | Примечание                                                                  |
|--------------|--------------------------|--------|-----------------------------------------------------------------------------|
| Питание      | +12V, -12V, +5V_A        | 3      | Питание для аналоговых схем и операционных усилителей. +5V_A - опционально. |
| Земля        | AGND, AGND               | 2      | Чистая аналоговая земля. Обязательно отделена от цифровой!                  |
| Аудио In/Out | AUDIO_OUT_L, AUDIO_OUT_R | 2      | Выход с Алесты на плату                                                     |
|              | AUDIO_IN_L, AUDIO_IN_R   | 2      | Вход с платы на Алесту                                                      |
| CV In/Out    | CV_OUT1, CV_OUT2         | 2      | Выходы управления (0-3.3V или 0-5V) с ЦАП Алесты                            |
|              | CV_IN1, CV_IN2           | 2      | Входы управления (0-3.3V) на АЦП Алесты                                     |

Итого: 13

ВСЕГО: 33

Остается 7 пинов в резерве на 40-пиновом разъеме! Их можно оставить неподключенными (NC) для будущего расширения.

## Практичные и почти обязательные улучшения

а) "Умное" питание на слотах.

Идея: Добавить на материнской плате простую схему определения потребления тока на каждом слоте (shunt resistor + amplifier + ADC input на FPGA).
Зачем: Чтобы программа могла показать: "Внимание! Плата в слоте B потребляет 450mA, это превышает лимит!". Это убережет от сгорания стабилизаторов и FPGA при коротком замыкании на платах расширения.

б) Выделенный сброс для плат.

Идея: Добавить сигнал PERIPH_RST_N (выход с FPGA), который подается на все слоты.
Зачем: Чтобы "жестко" перезагрузить зависшую периферию, не перезагружая весь компьютер. Можно повесить на "аварийную" комбинацию клавиш.

в) Электрическая защита.

Идея: Все пины, идущие на разъем, должны быть защищены TVS-диодами от статики и превышения напряжения, а также последовательными резисторами (33-100 Ом) для ограничения тока и подавления ringing.
Зачем: Это must-have для любой современной платы, которую будут постоянно тыкать и трогать. Спасет FPGA от смерти.

## Интересные и амбициозные улучшения

а) "Плата-конфигуратор" (Breadboard Buddy).

Идея: Создать простейшую плату-заглушку, которая выводит все эти сигналы (SPI, I2C, GPIO, CV, Audio) на удобные винтовые клеммы или просто пины для макетирования.
Зачем: Пользователь может быстро подцепить свой самопальный модуль на макетной плате, не паяя сразу полноценную плату. Это сильно снижает порог входа для экспериментов.

б) Цифровой аудиоинтерфейс (I2S/TDM).

Идея: Выделить 4-6 пинов под I2S (BCLK, LRCLK, DATA_OUT, DATA_IN, MCLK).
Зачем: Позволит подключать современные аудиокодеки и ЦАП/АЦП высшего класса напрямую, без лишних преобразований в аналог на самой Алесте. Цифровой звук будет передаваться на плату в чистом виде. Это путь к студийному качеству.

в) Восходящий SPI (SPI Upstream).

Идея: Сделать так, чтобы платы расширения могли не только слушать команды по SPI, но и инициировать передачу сами (режим SPI slave с DMA на стороне FPGA).
Зачем: Плата могла бы скидывать большие объемы данных (например, оцифрованный аудиосигнал с своего АЦП) прямо в память Алесты практически без участия ЦПУ. Сложно в реализации, но очень мощно.

## "Бредовые" и супер-креативные улучшения

а) Аналоговая шина модуляции.
Идея: Добавить один аналоговый пин MOD_BUS. Это не CV для конкретного параметра, а общая шина.
Зачем: Несколько плат могли бы суммировать свои модуляционные сигналы (LFO, ADSR) на эту одну шину через простые резисторы. Алеста оцифровывает результирующий сигнал и может использовать его для модуляции чего угодно в цифровом синтезаторе. Рождается уникальный "коллективный" источник модуляции.

б) "Плата-рекурсия".

Идея: Спецификация, что аудиовыход одной платы можно направить на аудиовход другой платы аппаратно, просто соединив их перемычками на колодке.
Зачем: Создание настоящих аппаратных патчей! Плата фильтра -> плата дисторшна -> плата задержки. Это будет не просто компьютер, а настоящий модульный синтезатор с возможностью работы без запущенной программы.

в) Подсветка "Under Glow".

Идея: Развести под разъемом дорожки для 4-х RGB-светодиодов, подключаемых к GPIO.
Зачем: Чистая эстетика. Плата могла бы подсвечиваться разными цветами в зависимости от режима работы (зеленый - готов, голубой - активен, красный - ошибка). Смотрится нереально круто в прозрачном корпусе.
Любая из этих идей может стать той самой "фишкой", которая выделит Алесту и ее экосистему на фоне всех остальных ретро-проектов. Вы создаете не компьютер, а инструмент 